services:
  # API Backend (Spring Boot + Java 21 avec Docker)
  - type: web
    name: stemadeleine-api
    runtime: docker
    plan: free
    region: frankfurt # EU region closest to France
    dockerfilePath: ./backend/api/Dockerfile
    dockerContext: ./backend/api
    envVars:
      # Database
      - key: SUPABASE_DB_URL
        sync: false
      - key: SUPABASE_DB_USER
        sync: false
      - key: SUPABASE_DB_PASSWORD
        sync: false
      # S3/Supabase Storage
      - key: S3_ACCESS_KEY_ID
        sync: false
      - key: S3_SECRET_ACCESS_KEY
        sync: false
      - key: S3_BUCKET
        value: medias-prod
      - key: S3_REGION
        sync: false
      - key: S3_ENDPOINT
        sync: false
      # JWT
      - key: JWT_SECRET_KEY
        generateValue: true
      - key: JWT_COOKIE_SECURE
        value: true
      # HelloAsso
      - key: HELLOASSO_CLIENT_ID
        sync: false
      - key: HELLOASSO_CLIENT_SECRET
        sync: false
      # reCAPTCHA
      - key: RECAPTCHA_SECRET_KEY
        sync: false
      # CORS - Origines additionnelles (Vercel, etc.)
      - key: CORS_ALLOWED_ORIGINS
        sync: false
      # Spring Profile
      - key: SPRING_PROFILES_ACTIVE
        value: prod
    healthCheckPath: /api/public/health

  # Frontend Site Public (Next.js)
  - type: web
    name: stemadeleine-frontend
    runtime: docker
    plan: free
    region: frankfurt
    dockerfilePath: ./frontend/stemadeleine/Dockerfile
    dockerContext: ./frontend/stemadeleine
    envVars:
      - key: NEXT_PUBLIC_API_URL
        value: https://stemadeleine-api.onrender.com
      - key: NEXT_PUBLIC_RECAPTCHA_SITE_KEY
        sync: false

  # Backoffice (Next.js)
  - type: web
    name: stemadeleine-backoffice
    runtime: docker
    plan: free
    region: frankfurt
    dockerfilePath: ./frontend/backoffice/Dockerfile
    dockerContext: ./frontend/backoffice
    envVars:
      - key: BACKEND_URL
        value: https://stemadeleine-api.onrender.com
      - key: NEXT_PUBLIC_API_URL
        value: https://stemadeleine-api.onrender.com

